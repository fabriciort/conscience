{"version":3,"sources":["turbopack:///[project]/lib/utils/access-control.ts","turbopack:///[project]/app/platform/watch/[id]/page.tsx"],"sourcesContent":["import type { SubscriptionTier, UserRole } from '@/lib/supabase/types';\n\n// Tier hierarchy for access control\nconst TIER_HIERARCHY: SubscriptionTier[] = ['free', 'essential', 'advanced', 'corporate'];\n\n/**\n * Check if user has access to content based on subscription tier\n */\nexport function canAccessContent(\n  userTier: SubscriptionTier,\n  contentTier: SubscriptionTier\n): boolean {\n  const userIndex = TIER_HIERARCHY.indexOf(userTier);\n  const contentIndex = TIER_HIERARCHY.indexOf(contentTier);\n  \n  return userIndex >= contentIndex;\n}\n\n/**\n * Check if user has researcher/admin role\n */\nexport function isResearcher(role: UserRole): boolean {\n  return role === 'researcher' || role === 'admin';\n}\n\n/**\n * Check if user is admin\n */\nexport function isAdmin(role: UserRole): boolean {\n  return role === 'admin';\n}\n\n/**\n * Get tier display name\n */\nexport function getTierDisplayName(tier: SubscriptionTier): string {\n  const names: Record<SubscriptionTier, string> = {\n    free: 'Gratuito',\n    essential: 'Essencial',\n    advanced: 'AvanÃ§ado',\n    corporate: 'Corporate Labs',\n  };\n  return names[tier];\n}\n\n/**\n * Get tier color for UI\n */\nexport function getTierColor(tier: SubscriptionTier): string {\n  const colors: Record<SubscriptionTier, string> = {\n    free: 'text-gray-600 bg-gray-100',\n    essential: 'text-blue-600 bg-blue-100',\n    advanced: 'text-purple-600 bg-purple-100',\n    corporate: 'text-amber-600 bg-amber-100',\n  };\n  return colors[tier];\n}\n\n","import { createClient } from '@/lib/supabase/server';\nimport { notFound, redirect } from 'next/navigation';\nimport Link from 'next/link';\nimport { canAccessContent } from '@/lib/utils/access-control';\nimport type { Video, Profile } from '@/lib/supabase/types';\n\ninterface VideoWithResearcher extends Video {\n  researcher?: {\n    full_name: string;\n    avatar_url: string | null;\n    id: string;\n  };\n}\n\nexport default async function WatchVideoPage({\n  params,\n}: {\n  params: Promise<{ id: string }>;\n}) {\n  const { id } = await params;\n  const supabase = await createClient();\n  \n  const { data: { user } } = await supabase.auth.getUser();\n  \n  if (!user) {\n    redirect('/auth/login');\n  }\n\n  const { data: profile } = await supabase\n    .from('profiles')\n    .select('*')\n    .eq('id', user.id)\n    .single() as { data: Profile | null };\n\n  const userTier = profile?.subscription_tier || 'free';\n\n  // Get video with researcher info\n  const { data: video, error } = await supabase\n    .from('videos')\n    .select(`\n      *,\n      researcher:profiles!researcher_id (\n        id,\n        full_name,\n        avatar_url\n      )\n    `)\n    .eq('id', id)\n    .eq('published', true)\n    .single();\n\n  if (error || !video) {\n    notFound();\n  }\n\n  const typedVideo = video as unknown as VideoWithResearcher;\n  const hasAccess = canAccessContent(userTier, typedVideo.required_tier);\n\n  // Get video embed URL\n  const getEmbedUrl = (url: string) => {\n    if (url.includes('youtube.com') || url.includes('youtu.be')) {\n      const videoId = url.includes('youtu.be/')\n        ? url.split('youtu.be/')[1].split('?')[0]\n        : new URL(url).searchParams.get('v');\n      return `https://www.youtube.com/embed/${videoId}`;\n    }\n    if (url.includes('vimeo.com')) {\n      const videoId = url.split('vimeo.com/')[1].split('?')[0];\n      return `https://player.vimeo.com/video/${videoId}`;\n    }\n    return url;\n  };\n\n  return (\n    <div className=\"min-h-screen bg-[color:var(--background)]\">\n      <div className=\"mx-auto max-w-[1400px] px-4 py-8 sm:px-6 lg:px-8\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          {/* Main Content */}\n          <div className=\"lg:col-span-2 space-y-6\">\n            {/* Video Player or Paywall */}\n            {hasAccess ? (\n              <div className=\"aspect-video bg-black rounded-xl overflow-hidden\">\n                <iframe\n                  src={getEmbedUrl(typedVideo.video_url)}\n                  className=\"w-full h-full\"\n                  allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                  allowFullScreen\n                ></iframe>\n              </div>\n            ) : (\n              <div className=\"relative aspect-video bg-[color:var(--surface)] rounded-xl overflow-hidden border border-[color:var(--border)]\">\n                <div className=\"absolute inset-0 flex items-center justify-center backdrop-blur-md bg-black/60\">\n                  <div className=\"text-center max-w-md px-6\">\n                    <div className=\"text-6xl mb-4\">ðŸ”’</div>\n                    <h3 className=\"text-2xl font-bold text-white mb-3\">\n                      Upgrade to Access\n                    </h3>\n                    <p className=\"text-white/80 mb-6\">\n                      This video requires a {getTierName(typedVideo.required_tier)} subscription or higher.\n                    </p>\n                    <Link\n                      href=\"/pricing\"\n                      className=\"inline-block px-8 py-3 bg-gradient-to-r from-[color:var(--primary)] to-[color:var(--accent)] text-white font-semibold rounded-lg hover:opacity-90 transition-opacity\"\n                    >\n                      View Plans\n                    </Link>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Video Info */}\n            <div>\n              <h1 className=\"text-3xl font-bold text-[color:var(--text-primary)] mb-4\">\n                {typedVideo.title}\n              </h1>\n\n              <div className=\"flex items-center gap-4 mb-6\">\n                <Link\n                  href={`/platform/researchers/${typedVideo.researcher?.id}`}\n                  className=\"flex items-center gap-3 hover:opacity-80 transition-opacity\"\n                >\n                  <div className=\"w-12 h-12 rounded-full bg-gradient-to-br from-[color:var(--primary)] to-[color:var(--accent)] flex items-center justify-center text-lg font-semibold text-white\">\n                    {typedVideo.researcher?.full_name.charAt(0).toUpperCase()}\n                  </div>\n                  <div>\n                    <p className=\"font-semibold text-[color:var(--text-primary)]\">\n                      {typedVideo.researcher?.full_name}\n                    </p>\n                    <p className=\"text-sm text-[color:var(--text-secondary)]\">\n                      Researcher\n                    </p>\n                  </div>\n                </Link>\n\n                <div className=\"ml-auto flex items-center gap-4\">\n                  <span className=\"text-sm text-[color:var(--text-secondary)]\">\n                    {typedVideo.view_count || 0} views\n                  </span>\n                  <span className={`px-3 py-1.5 rounded-lg text-sm font-semibold ${getTierColor(typedVideo.required_tier)}`}>\n                    {getTierName(typedVideo.required_tier)}\n                  </span>\n                </div>\n              </div>\n\n              {typedVideo.description && (\n                <div className=\"bg-[color:var(--surface)] rounded-xl border border-[color:var(--border)] p-6\">\n                  <h2 className=\"text-lg font-semibold text-[color:var(--text-primary)] mb-3\">\n                    About\n                  </h2>\n                  <p className=\"text-[color:var(--text-secondary)] whitespace-pre-wrap\">\n                    {typedVideo.description}\n                  </p>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Sidebar */}\n          <div className=\"space-y-6\">\n            {/* Tags */}\n            {typedVideo.tags && typedVideo.tags.length > 0 && (\n              <div className=\"bg-[color:var(--surface)] rounded-xl border border-[color:var(--border)] p-6\">\n                <h3 className=\"text-lg font-semibold text-[color:var(--text-primary)] mb-3\">\n                  Tags\n                </h3>\n                <div className=\"flex flex-wrap gap-2\">\n                  {typedVideo.tags.map((tag) => (\n                    <span\n                      key={tag}\n                      className=\"px-3 py-1.5 bg-[color:var(--surface-hover)] rounded-lg text-sm text-[color:var(--text-secondary)]\"\n                    >\n                      {tag}\n                    </span>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* CTA */}\n            {!hasAccess && (\n              <div className=\"bg-gradient-to-br from-[color:var(--primary)] to-[color:var(--accent)] rounded-xl p-6 text-white\">\n                <h3 className=\"text-lg font-bold mb-2\">\n                  Want full access?\n                </h3>\n                <p className=\"text-white/90 text-sm mb-4\">\n                  Upgrade your plan to unlock this content and more.\n                </p>\n                <Link\n                  href=\"/pricing\"\n                  className=\"block text-center px-6 py-3 bg-white text-[color:var(--primary)] font-semibold rounded-lg hover:bg-white/90 transition-colors\"\n                >\n                  Upgrade Now\n                </Link>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction getTierName(tier: string): string {\n  const names: Record<string, string> = {\n    free: 'Free',\n    essential: 'Essential',\n    advanced: 'Advanced',\n    corporate: 'Corporate',\n  };\n  return names[tier] || tier;\n}\n\nfunction getTierColor(tier: string): string {\n  const colors: Record<string, string> = {\n    free: 'bg-gray-500/10 text-gray-400',\n    essential: 'bg-purple-500/10 text-purple-400',\n    advanced: 'bg-rose-500/10 text-rose-400',\n    corporate: 'bg-amber-500/10 text-amber-400',\n  };\n  return colors[tier] || 'bg-gray-500/10 text-gray-400';\n}\n"],"names":[],"mappings":"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"}